<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Open Folder Demo</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f3f3f3;
    }
    .container {
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    h1 {
        text-align: center;
        color: #333;
    }
    #folderInput {
        margin-bottom: 20px;
    }
    #searchInput {
        margin-bottom: 20px;
        padding: 10px;
        width: calc(100% - 20px);
        border: 1px solid #ccc;
        border-radius: 5px;
    }
    #filterSelect {
        margin-bottom: 20px;
        padding: 10px;
        width: calc(100% - 20px);
        border: 1px solid #ccc;
        border-radius: 5px;
        background-color: #f9f9f9;
        appearance: none; /* Remove default arrow */
        cursor: pointer;
    }
    #filterSelect option {
        padding: 10px;
        background-color: #fff;
    }
    #fileContainer {
        margin-top: 20px;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
    }
    .file-item {
        flex-basis: calc(33.33% - 10px);
        padding: 10px;
        background-color: #f9f9f9;
        border-radius: 5px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    .file-item:hover {
        background-color: #e9e9e9;
    }
    /* Modal styling */
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.7);
    }
    .modal-content {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        padding: 20px;
        width: 80%;
        max-width: 600px;
        background-color: #fff;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
    }
    .modal-img {
        max-width: 100%;
        height: auto;
        border-radius: 10px;
    }
    .close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 10px;
        background-color: #333;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }
    .close-btn:hover {
        background-color: #555;
    }
</style>
</head>
<body>
    <div class="container">
        <h1>Open Folder Demo</h1>
        <input type="file" id="folderInput" webkitdirectory directory multiple>
        <input type="text" id="searchInput" placeholder="Search for file name...">
        <select id="filterSelect">
            <option value="all">Alla filer</option>
            <option value="exe">.exe-filer</option>
            <option value="dmg">.dmg-filer</option>
            <option value="app">.app-filer</option>
            <option value="jar">.jar-filer</option>
            <option value="png">.png-filer</option>
            <option value="txt">.txt-filer</option>
            <!-- Lägg till fler filtyper här -->
        </select>
        <div id="fileContainer"></div>
    </div>

    <!-- Modal -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">Stäng</button>
            <img id="modalImg" class="modal-img" src="" alt="Popup-bild">
            <div id="imageInfo" style="margin-top: 10px;"></div>
        </div>
    </div>

    <script>
        // Funktion för att hantera mappinmatning
        function handleFolderInput(event) {
            var fileContainer = document.getElementById("fileContainer");
            fileContainer.innerHTML = ""; // Rensa tidigare innehåll

            var files = event.target.files;
            for (var i = 0; i < files.length; i++) {
                var file = files[i];
                if (isImageFile(file) || isTextFile(file)) { // Kontrollera om det är en bild eller textfil
                    var fileName = file.webkitRelativePath || file.name;
                    var fileItem = document.createElement("div");
                    fileItem.classList.add("file-item");
                    fileItem.textContent = fileName.split('/').pop(); // Extrahera filnamn
                    fileItem.setAttribute("data-src", URL.createObjectURL(file)); // Lagra fil-URL som dataattribut
                    fileItem.setAttribute("data-type", file.type); // Lagra filtyp som dataattribut
                    fileItem.addEventListener("click", openModal); // Lägg till klickhändelselyssnare
                    fileContainer.appendChild(fileItem);
                }
            }
            handleSearchInput(); // Anropa sökfunktionen efter att ha lagt till filer
            handleFilterChange(); // Anropa filterfunktionen efter att ha lagt till filer
        }

        // Funktion för att kontrollera om en fil är en bildfil
        function isImageFile(file) {
            return file.type.startsWith("image/");
        }

        // Funktion för att kontrollera om en fil är en textfil
        function isTextFile(file) {
            return file.type === "text/plain";
        }

        // Funktion för att hantera sökinmatning
        function handleSearchInput() {
            var searchTerm = document.getElementById("searchInput").value.toLowerCase();
            var fileItems = document.querySelectorAll(".file-item");

            fileItems.forEach(function(fileItem) {
                if (fileItem.textContent.toLowerCase().includes(searchTerm)) {
                    fileItem.style.display = "block";
                } else {
                    fileItem.style.display = "none";
                }
            });
        }

        // Funktion för att hantera filterändring
        function handleFilterChange() {
            var fileItems = document.querySelectorAll(".file-item");

            fileItems.forEach(function(fileItem) {
                if (isFileOfType(fileItem.textContent)) {
                    fileItem.style.display = "block";
                } else {
                    fileItem.style.display = "none";
                }
            });
        }

        // Funktion för att kontrollera om en fil är av en viss typ baserat på filnamn
        function isFileOfType(fileName) {
            var filterValue = document.getElementById("filterSelect").value;
            if (filterValue === "all") {
                return true;
            }
            var allowedExtensions = {
                "exe": [".exe"],
                "dmg": [".dmg"],
                "app": [".app"],
                "jar": [".jar"],
                "png": [".png"],
                "txt": [".txt"]
                // Lägg till fler filtyper här
            };
            var extension = fileName.split('.').pop().toLowerCase();
            return allowedExtensions[filterValue].includes("." + extension);
        }

        // Funktion för att öppna modal
        function openModal(event) {
            var fileItem = event.target;
            var fileType = fileItem.getAttribute("data-type");
            if (fileType.startsWith("image/")) { // Kontrollera om det är en bildfil
                var modal = document.getElementById("myModal");
                var modalImg = document.getElementById("modalImg");
                var imageInfo = document.getElementById("imageInfo");
                modalImg.src = fileItem.getAttribute("data-src");
                imageInfo.textContent = "Filnamn: " + fileItem.textContent;
                modal.style.display = "block";
            }
        }

        // Funktion för att stänga modal
        function closeModal() {
            var modal = document.getElementById("myModal");
            modal.style.display = "none";
        }

        // Lägg till händelselyssnare för mappinmatning
        var folderInput = document.getElementById("folderInput");
        folderInput.addEventListener("change", handleFolderInput);

        // Lägg till händelselyssnare för sökinmatning
        var searchInput = document.getElementById("searchInput");
        searchInput.addEventListener("input", handleSearchInput);

        // Lägg till händelselyssnare för filterval
        var filterSelect = document.getElementById("filterSelect");
        filterSelect.addEventListener("change", handleFilterChange);

        // Stäng modal när du klickar utanför bilden
        window.addEventListener("click", function(event) {
            var modal = document.getElementById("myModal");
            if (event.target == modal) {
                modal.style.display = "none";
            }
        });
    </script>
</body>
</html>
